---

layout: post
title: 'ASIO C++20 协程'
subtitle: 'ASIO C++20 Coroutines'
date: 2022-09-28
categories: [article]
tags: 'C++' 

---

Awaitable (`awaitable<>` & `use_awaitable`) 协程使用 `awaitable_thread` 来管理协程帧栈并驱动协程的运行。而 Resumable (`coro<>` & `use_coro`) 协程利用 `awaiter` 的 `await_suspend(coroutine_handle<>)` 返回协程句柄自动驱动协程执行，这一点上与阿里的 [`async_simple`](https://yanminhui.github.io/2022/09/20/async-simple.html) 机制相同。

## C++20 Awaitable Coroutines

![awaitable coroutines](https://www.plantuml.com/plantuml/png/hLV1Sfim4Btp5Jh2mUwT0IQPJjBn9JtKROyQ1UI1YImnah3hVdqbZ2q9X21fJhP1UljstzEk_20auh8xagXaKBJeJC6c03y5vbyPPyyTBLEGPJjwOc-uA29KokQ497PMHFOFUtiA6jh81X4eEj5YMiL92eQl494pkeWfeY6IRJRcwNQxTIZUlaDC9R_0bZLKsbJ1wsM8BZ6yBJRHVDiZtyEvM0hpdGdEehWP1uAzCYdP4R83LAgLRn3a0T2r1NlK_8Q2eJDg97eb6CgQOrHj2LAIrdU15S4Pd7wdgO86Kmlxf-0G9mPXu_YZxKGD3nmTSUp3JG2Y5P2iTNAMTIDSmA2QirKDMjukIziTszXceKZSrYTHdWCaBhI4kc8WpoV7mRmT6_JsHdH4Pft0y2v0aQOtzyPAoSJOoA15LbWdp9mtVI1NipYKTRt62xIRvlCQ0ePCO1OF-RYRUnadW9OzxlLUjiHi4jxEqdSmsmckN4i-6CL8Hg9K36eP9hL9mOarbH5aM1SDdtqvxdkpaX76Kuwhei8gRZqSppZ9llIlYhueDHAA0vNuZmfqRcHPwyhm3jkSTEhtO7WItsQ_ARJiuFVZRhzx-GPsty7JhwUN_G-WpU100eSZabwEItRbM7QSmXCY7Hvxn2ld0jwXeOxvhMozPoZaGwNvrOPAk9b6i6m_z_nyJjkQEOEwfLpPxj_BouEPPS-wbirVUqnW3Ygix2QKmqh9k6eta_cn7DihYcavUUxffsPyE9Ov9TDmVd4SZ81Dl9USyGGBMCEhtcSFhZLpFJp0ravtdwcMit0lKxE4QzN12ERNWx_CQ6n9TSTmxRY2eKVfZrm17HCcVeJWnUuZGGEkNQs6QNY1G25_quwGLlALzzT5r_vtjrd9Ow5MrqKFggxgRz4_ "awaitable coroutines")

![awaitable coroutines](https://www.plantuml.com/plantuml/png/bLJ1RYCX3BtFLo3raaQQVi1kLVKZzhPQMGpZP6W9832RLDtzznA6P4XW3iqXIkndlySp-DKJTnGEgXEAUy_uaKlYWqBOENv06BX7zjcn-FbhvCWu4HSJqEIGZvi5FGUsRE9wLEWUKqMT7h4idr7fomO_pPIRbeGj4rnT-oObrjXSyDWjKOS-fD0rCg8dPpukg0ScZ3E1f4QOnQO0v6GjUJunZZbG0skL5moU15gIHeCbnopgKUezBD7kVzVq--dfPUd_W-sHm245fy4CRoZeV9Rsk7xbMVKiQ2_t6aSc9kwIBOhWzv-S7OnHSLOUSc9DoVE_lgz9rjYJtv_VwdKkMMk7cjm7M2Cr5SUAnh40F_F_zXWetWspWtYtnJjafE1Qe58yEU-L8MQvYnHG9TeLn0aR8RXt54ye0XbN9OJHX2S2VvIKBbG9Y9VB747kBchEwU_uM7XLsNarhzbk_bcIiMtVlpJ1zQJcHr5k2CM35jFcVWCKZ8NM37l8JpeSx3Moo1aCaJaK0osDoG9k9TSwyrugzzdQ6xuibGRBdVLbqrNAo7RJwaP9ks7t6bT5tCbV "awaitable coroutines")

## C++20 Resumable Coroutines

![resumable coroutines](https://www.plantuml.com/plantuml/png/bLRBhjiW4DtxAzWrMJZTMxPrgqfNwWTqZOWzqKMNW0KuKVhr1J_2mzXETYRCuymvCqC-b2PIzrUMDGAhZjmvoclqLu7yBQJux7bJeBByms_Y6-ew8uscDw8XiCZyW-zU8CgffeHXrQiEU7iu5cZwn8JToKCj8peWPPwxNq-dKm2n4qhZnjpqcd98Wmnjil2u339ylOKvuH_2tpG8c9g_JkHEg8OMNwIueYgAS3Y-I4-iu2yBsP1ZgfiAr829Ul06Ir3z5RAgGlEPjAYg5ggwMvzjT7uW2m_RgFYBy9Q1j5bSSARBNet5rqKnPpyOo4Vak7JXCmz7aFTzWIBVi2PBO6nWULnhvv5Bm_8WqRBg3SOcv8FZ4_TiRl2_ZNDRd5djLIQzCe8ATfYNe7l9yOsmthQYPvt2k1FiGlcsY9vxNcSjf5h5wXL57h1OhBRpnYuprRa16_izW3_wfK2MvQU5IVzPDYDLKjRFEJDZuJFxGw66C7OcpJUQ1YvPqCXSLINcp-sAG8RRSTajpxMm7cF1lhztV6p1faykds9tpIsNjSzJodjlLnVeIp0dwg3mHFKekHR8B1tvwj8FEzkYAXl1X2maj7LddaYxS3f33LLG_XokN3_ONeZXjQ2q5BO90bpE9rz0IR4UurzxL5uiCwqwEJF0sa-_-N8-foMPOYvS0RjO7gEK--_ZAepn-iE4CVzN_WC0 "resumable coroutines")

![resumable coroutines](https://www.plantuml.com/plantuml/png/TLBBRiCW4Bpp5NjqKza_qCYAr5_e7H6yJcWn85YIMct-lHYJn6xQ2zgTVSpCYbqWuIaEcaajGW1flUNYB1HXntjl1_XY0246XwQp7dfbXEObhvvOAZxdeKZA83yAqsdSjh1SyS8kRBdU9Km5vFWfK_y1sKGnAjGTLyP5Al59w8Y90k1aLGSUANfpGo_iKUhskwx_eVY3FpiJaImSa58doXJxJ7X3PpyPcqOpLeJO_JjAogLo3YxqMOm1b56aLbS2cDRp8sg7VhuD9ozCwAqVggPfoY6l8ZYD3k_PrUnlLu-6LttGD6skBjtVNOim6fdSX3XWzMe7fv6KDM_s0mtGz6PLQuBDd1L5iAdhTYrWbnodx_G3 "resumable coroutines")

## Reference

- [boost.asio 1.80.0](https://www.boost.org/doc/libs/1_80_0/doc/html/boost_asio/overview/composition/cpp20_coroutines.html)